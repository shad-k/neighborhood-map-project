function initMap(){pos=new google.maps.LatLng(28.6375771,77.22336),map=new google.maps.Map(document.getElementById("map"),{zoom:15,center:pos,mapTypeControl:!1}),defaultIcon=makeMarkerIcon("0091ff"),highlightedIcon=makeMarkerIcon("FFFF24"),largeInfowindow=new google.maps.InfoWindow,ko.applyBindings(new ViewModel)}function makeMarkers(a){for(var b=0;b<a.length;b++){var c=new google.maps.Marker({position:a[b].geometry.location,map:map,title:a[b].name,icon:defaultIcon});markers.push(c),c.addListener("click",function(){populateInfoWindow(this,largeInfowindow),this.setAnimation(google.maps.Animation.BOUNCE)}),c.addListener("mouseover",function(){this.setIcon(highlightedIcon)}),c.addListener("mouseout",function(){this.setIcon(defaultIcon)})}fitBounds()}function fitBounds(){for(var a=new google.maps.LatLngBounds,b=0;b<markers.length;b++)!0===markers[b].getVisible()&&a.extend(markers[b].position);map.fitBounds(a)}function makeMarkerIcon(a){return new google.maps.MarkerImage("http://chart.googleapis.com/chart?chst=d_map_spin&chld=1.15|0|"+a+"|40|_|%E2%80%A2",new google.maps.Size(21,34),new google.maps.Point(0,0),new google.maps.Point(10,34),new google.maps.Size(21,34))}function populateInfoWindow(a,b){b.marker!=a&&$.ajax({url:"https://developers.zomato.com/api/v2.1/locations?apikey=7fdd26d8333950e56b339a2038e799c1&query="+a.title+"&lat="+a.position.lat()+"&lon="+a.position.lng(),success:function(c){var d;$.ajax({url:"https://developers.zomato.com/api/v2.1/location_details?apikey=7fdd26d8333950e56b339a2038e799c1&entity_id="+c.location_suggestions[0].entity_id+"&entity_type="+c.location_suggestions[0].entity_type,success:function(c){d=c.best_rated_restaurant[0]?"<p>"+a.title+"</p><p>Average Cost of Two = "+c.best_rated_restaurant[0].restaurant.average_cost_for_two+"</p>":"<p>"+a.title+"</p><p>Nightlife Index = "+c.nightlife_index+"</p>",b.marker=a,b.setContent("<div>"+d+"</div>"),b.open(map,a),b.addListener("closeclick",function(){b.marker=null,a.setAnimation(null)})},error:function(){alert("There is a problem with the Zomato API. Please try again after some time")},crossDomain:!0})},error:function(a){alert("There is a problem with the Zomato API. Please try again after some time")},crossDomain:!0})}function updateMarkers(a){hideMarkers();for(var b=0;b<a.length;b++)!0===a[b].show()&&(markers[b].setVisible(!0),console.log(a[b].name));fitBounds()}function hideMarkers(){for(var a=0;a<markers.length;a++)markers[a].setVisible(!1)}function mapError(){alert("The site is not available right now. Please try after some time")}function triggerClick(a){a&&google.maps.event.trigger(a,"click")}document.querySelector(".arrow").addEventListener("click",function(a){document.querySelector(".searchAndList").classList.toggle("slipIn"),document.querySelector(".arrow").classList.toggle("floatRight")});var markers=[],map,pos,defaultIcon,highlightedIcon,largeInfowindow,ViewModel=function(){var a=new google.maps.places.PlacesService(map),b=this;this.placeList=ko.observableArray([]),a.nearbySearch({location:pos,radius:"4000",type:"restaurant"},function(a,c){for(var d=0;d<a.length;d++)a[d].show=ko.observable(!0),b.placeList.push(a[d]);makeMarkers(b.placeList())}),this.filterText=ko.observable(),this.filter=function(a,c){if(13===c.keyCode){for(var d=0;d<b.placeList().length;d++)b.placeList()[d].name.includes(b.filterText())?b.placeList()[d].show(!0):b.placeList()[d].show(!1);updateMarkers(b.placeList())}},this.showInfoWindow=function(a){triggerClick(markers[a()])}};